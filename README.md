# literature-search-bot

Бот для мессенджера Telegram, осуществляющий поиск по технической литературе (в текстовом формате), выдачу результатов и пересылку файлов пользователю.
Реализована система контроля доступа на основе ролей (администратор, обычный пользователь, гость).

## Поддерживаемые действия и команды

Роли пользователей, строго по возрастанию прав:

| Роль                             | Поиск, получение файлов | Управление файлами | Изменение роли других пользователей |
|----------------------------------|-------------------------|--------------------|-------------------------------------|
| Гость                            | нет                     | нет                | нет                                 |
| Обычный пользователь (`REGULAR`) | да                      | нет                | нет                                 |
| Администратор (`ADMIN`)          | да                      | да                 | да                                  |

Примечания:
- Чтобы зарегистрироваться в боте, нужно отправить запрос на регистрацию через команду `/register`. Далее администратор одобрит или отклонит его.
- Пароли не используются, т. к. пользователя можно однозначно идентифицировать по Telegram ID.
- Через интерфейс бота администратор не может назначить, разжаловать или разрегистрировать других администраторов.

Список доступных команд приведён ниже.

| Команда              | Аргументы                  | Описание                                                                           | Минимальная роль |
|----------------------|----------------------------|------------------------------------------------------------------------------------|------------------|
| `/start`             |                            | Начать работу с ботом                                                              | Гость            |
| `/help`              | `[command]`                | Вывести список доступных команд или краткую справку по конкретной команде          | Гость            |
| `/whoami`            |                            | Краткая информация о текущем пользователе                                          | Гость            |
| `/register`          |                            | Отправить запрос на регистрацию (только для гостя)                                 | Гость            |
| `/search`            | `<query...>`               | Поиск по заданному запросу с выдачей результатов и кнопок для получения документов | `REGULAR`        |
| `/prefs`             |                            | Открыть меню кнопок для настройки предпочтений пользователя                        | `REGULAR`        |
| `/a_list_users`      | `[role]`                   | Список пользователей (всех или с указанной ролью)                                  | `ADMIN`          |
| `/a_register_user`   | `<user_id>`                | Зарегистрировать пользователя с заданным Telegram ID напрямую.                     | `ADMIN`          |
| `/a_unregister_user` | `<user_id>`                | Разрегистрировать пользователя с заданным Telegram ID напрямую.                    | `ADMIN`          |
| `/a_list_reqs`       | `[status]`                 | Список запросов на регистрацию (открытых или с указанным статусом)                 | `ADMIN`          |
| `/a_approve_req`     | `<request_id>`             | Одобрить заданный запрос на регистрацию                                            | `ADMIN`          |
| `/a_reject_req`      | `<request_id> [reason...]` | Отклонить заданный запрос на регистрацию                                           | `ADMIN`          |
| `/a_reindex`         |                            | Реиндексация файлов в каталоге                                                     | `ADMIN`          |
| `/a_index_info`      |                            | Вывести информацию о текущем индексе                                               | `ADMIN`          |

> Легенда аргументов:
> - `<arg>` -- обязательный аргумент без пробелов
> - `[arg]` -- необязательный аргумент без пробелов, такой аргумент идёт после всех обязательных
> - `<arg...>`, `[arg...]` -- аргумент с произвольным количеством пробелов, такой аргумент идёт последним

## Инструкция по развёртыванию
*Основная статья: [Инструкция по развёртыванию приложения](./docs/deploy.md)*

## Спецификация требований
*Основная статья: [Спецификация требований (SRS)](./docs/srs.md)*

Полная спецификация требований описана в [соответствующем документе](./docs/srs.md).
Ниже приведены функциональные требования, как они описаны в SRS. 
> - **FR-1 Регистрация и роли**
>    - Система должна поддерживать роли Гость, `REGULAR` и `ADMIN`.
>    - Бот должен предоставлять гостю возможность отправить запрос на регистрацию через команду `/register`.
>    - Администратор должен иметь возможность просматривать запросы, утверждать или отклонять их и регистрировать пользователя с указанной ролью.
> - **FR-2 Управление пользователями и заявками**
>   - Администратор должен иметь возможность просматривать список пользователей и их ролей.
>   - Администратор должен иметь возможность регистрировать и удалять зарегистрированных пользователей.
>   - Администратор должен иметь возможность просматривать и фильтровать заявки по статусу.
> - **FR-3 Контроль доступа**
>   - Гости не должны иметь доступа к поиску и выдаче документов.
>   - `REGULAR` и `ADMIN` должны иметь доступ к поиску и получению файлов.
>   - Административные команды должны быть доступны только пользователям с ролью `ADMIN`.
> - **FR-4 Индексация**
>   - Бот должен уметь обходить каталог документов, отбирать поддерживаемые типы файлов и извлекать из них текст.
>   - Извлеченный текст должен сохраняться в локальный кэш (индекс) в отдельной директории.
>   - Администратор должен иметь возможность запускать индексацию командой `/a_reindex` и просматривать статус индексации командой `/a_index_info`.
> - **FR-5 Поиск и выдача документов**
>   - Зарегистрированные пользователи должны иметь возможность выполнять поиск по тексту через команду `/search <query...>`.
>   - Бот должен возвращать список найденных документов в виде сообщений и/или интерактивных кнопок.
>   - Пользователь должен иметь возможность выбрать документ и получить исходный файл через Telegram.

## Стек использованных технологий
- Исходный код:
  - Язык программирования: [Kotlin 2.3.0](https://kotlinlang.org/) (JVM)
  - Фреймворк для интеграции БД / ORM:
  - Библиотека для взаимодействия с Telegram API:
  - Библиотека для реализации поиска:
  - Библиотека для переменных окружения:
  - Библиотека для тестирования: JUnit Jupiter
- Окружение:
  - Окружение языка: JDK Temurin 17
  - Встраиваемая СУБД: SQLite
  - Драйвер для JDBC: 
- Сборка:
  - Средство сборки: Gradle (Gradle Kotlin DSL)
  - Статический анализ (lint): 
  - Тестирование: 
- Развёртывание: 
  - Контейнеризация: 